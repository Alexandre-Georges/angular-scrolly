/*
 * angular-scrolly - v0.0.1 - 2013-05-29
 * http://github.com/ajoslin/angular-scrolly
 * Created by Andy Joslin; Licensed under Public Domain
 */
angular.module("ajoslin.scrolly",["ajoslin.scrolly.dragger","ajoslin.scrolly.transformer","ajoslin.scrolly.scroller","ajoslin.scrolly.directives"]),angular.module("ajoslin.scrolly.directives",["ajoslin.scrolly.scroller"]).directive("scrollyScroll",["$scroller","$document",function(a){return angular.element(document.body).bind("touchmove",function(a){a.preventDefault()}),{restrict:"A",link:function(b,c){new a(c)}}}]),angular.module("ajoslin.scrolly.dragger",[]).provider("$dragger",function(){function a(a,b){for(;a.parentNode;){if(a.getAttribute&&a.getAttribute(b))return a;a=a.parentNode}return null}var b=!0;this.shouldBlurOnDrag=function(a){return arguments.length&&(b=!!a),b};var c=6;this.minDistanceForDrag=function(a){return arguments.length&&(c=a),c};var d=300;this.maxTimeMotionless=function(a){return arguments.length&&(d=a),d},this.$get=["$window","$document",function(e){function f(e){function f(a,b){angular.forEach(o,function(c){c(a,b)})}function i(a){n.startPos=n.pos=a,n.startTime=Date.now(),n.dragging=!0}function j(c){if(g||!c.button){var d=c.target||c.srcElement,e=c.touches?c.touches[0]:c;a(d,"data-dragger-ignore")||(b&&"INPUT"!==d.tagName&&"TEXTAREA"!==d.tagName&&"SELECT"!==d.tagName&&document.activeElement&&document.activeElement.blur(),n.moved=!1,n.inactiveDrag=!1,n.delta=0,n.pos=0,n.distance=0,i(e.pageY),f({type:"start",startPos:n.startPos,startTime:n.startTime}))}}function k(a){if(a.preventDefault(),n.dragging){var b=a.touches?a.touches[0]:a,e=b.pageY-n.pos;if(n.delta=e,n.pos=b.pageY,n.distance=n.pos-n.startPos,Math.abs(n.pos-n.startPos)<c)return;n.moved=!0;var g=n.lastMoveTime-n.startTime;g>d&&i(n.pos),n.lastMoveTime=a.timeStamp||Date.now(),f({type:"move",startPos:n.startPos,startTime:n.startTime,pos:n.pos,delta:n.delta,distance:n.distance})}}function l(){if(n.dragging){n.dragging=!1;var a=Date.now()-n.startTime,b=a>d;f({type:"end",startPos:n.startPos,startTime:n.startTime,pos:n.pos,delta:n.delta,distance:n.distance,duration:a,inactiveDrag:b})}}var m={};e[0];var n={startPos:0,startTime:0,pos:0,delta:0,distance:0,lastMoveTime:0,inactiveDrag:!1,dragging:!1},o=[];return e.bind(h.start,j),e.bind(h.move,k),e.bind(h.end,l),h.cancel&&e.bind(h.cancel,l),g||e.bind("mouseout",function(a){var b=a.relatedTarget;if(b){for(;b=b.parentNode;)if(b===e)return;l(a)}else l(a)}),m.addListener=function(a){if(!angular.isFunction(a))throw new Error("Expected callback to be a function, instead got '"+typeof a+'".');o.push(a)},m.removeListener=function(a){if(!angular.isFunction(a))throw new Error("Expected callback to be a function, instead got '"+typeof a+'".');var b=o.indexOf(a);b>-1&&o.splice(b,1)},m}var g="ontouchstart"in e,h={start:g?"touchstart":"mousedown",move:g?"touchmove":"mousemove",end:g?"touchend":"mouseup",cancel:g?"touchcancel":""};return f.events=function(){return h},f}]}),angular.module("ajoslin.scrolly.scroller",["ajoslin.scrolly.dragger","ajoslin.scrolly.scroller"]).provider("$scroller",function(){function a(a){var b=window.getComputedStyle(a),c=parseInt(b["margin-top"],10)+parseInt(b["padding-top"],10),d=parseInt(b["margin-bottom"],10)+parseInt(b["padding-bottom"],10),e=parseInt(b.height,10);return{top:c,bottom:d,height:e}}function b(a){return 0|a}function c(a){return Math.abs(a)*g+f}var d=.001;this.decelerationRate=function(a){return arguments.length&&(d=a),d};var e=40;this.bounceBuffer=function(a){return arguments.length&&(e=a),e};var f=200,g=1.5;this.bounceBackMinTime=function(a){return arguments.length&&(f=a),f},this.bounceBackDistanceMulti=function(a){return arguments.length&&(g=a),g},this.$get=["$dragger","$transformer","$window",function(f,g,h){function i(i){function j(){var b=a(p),c=h.innerHeight;return o.scrollHeight=b.height<c?0:b.height-c+b.top+b.bottom,o.scrollHeight}function k(a){return a>0?a:a<-o.scrollHeight?a+o.scrollHeight:!1}function l(a){switch(a.type){case"start":q.changing&&q.stop(),j();break;case"move":var c=q.pos+a.delta;k(c)&&(c=q.pos+b(.5*a.delta)),q.setTo(c);break;case"end":if(k(q.pos)||a.inactiveDrag)m();else{j();var d=n(a);d.position!==q.pos&&q.easeTo(d.position,d.time,m)}}}function m(){j();var a=k(q.pos);if(a){var b=a>0?0:-o.scrollHeight;q.easeTo(b,c(a))}}function n(a){var c,f=Math.abs(a.distance)/a.duration,g=q.pos+f*f/(2*d)*(a.distance<0?-1:1),h=f/d,i=k(g);return i&&(i>0?(g=Math.min(i,e),c=Math.abs(g-q.pos),h=c/f):0>i&&(g=Math.max(g,-(o.scrollHeight+e)),c=Math.abs(g-q.pos),h=c/f)),{position:g,time:b(h)}}var o={},p=i[0],q=new g(i),r=new f(i);return window.s=o,j(),r.addListener(l),i.bind("$destroy",function(){r.removeListener(l)}),o}return i}]}),angular.module("ajoslin.scrolly.transformer",[]).factory("$nextFrame",["$window",function(a){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(b){return a.setTimeout(b,17)}}]).provider("$transformer",function(){var a="cubic-bezier(0.25, 0.46, 0.45, 0.94)";this.timingFunction=function(b){return arguments.length&&(a=b),a},this.$get=["$window","$nextFrame",function(b,c){function d(b){return g+" "+b+"ms "+a}function e(a){var e={},g=a[0];e.$$calcPosition=function(){var a=b.getComputedStyle(g)[f].replace(/[^0-9-.,]/g,"").split(",");return a.length>1?parseInt(a[5],10):0},e.pos=e.$$calcPosition();var i;return e.stop=function(a){i&&(b.clearTimeout(i),i=null),g.style[h]="none",e.pos=e.$$calcPosition(),e.changing=!1,c(function(){e.setTo(e.pos),a&&a()})},e.easeTo=function(a,f,j){function k(){g.style[h]=d(f),e.changing=!0,c(function(){e.setTo(a),i=b.setTimeout(function(){e.stop(),j&&j()},f)})}if(!angular.isNumber(f)||0>f)throw new Error("Expected a positive number for time, got '"+f+"'.");e.changing?e.stop(k):k()},e.setTo=function(a){e.pos=a,g.style[f]="translate3d(0,"+a+"px,0)"},e}var f="webkitTransform",g="-webkit-transform",h="webkitTransition";return e.transformProp=f,e.transformPropDash=g,e.transitionProp=h,e}]});